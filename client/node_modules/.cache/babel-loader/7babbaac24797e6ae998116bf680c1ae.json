{"ast":null,"code":"import n, { useRef as e, useEffect as t, cloneElement as r } from \"react\";\n\nfunction o(n, e, t) {\n  return e in n ? Object.defineProperty(n, e, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : n[e] = t, n;\n}\n\nvar u = {\n  click: \"onClick\",\n  mousedown: \"onMouseDown\",\n  mouseup: \"onMouseUp\",\n  touchstart: \"onTouchStart\",\n  touchend: \"onTouchEnd\"\n},\n    c = function c(_c) {\n  var i,\n      a = _c.children,\n      d = _c.onClickAway,\n      l = _c.mouseEvent,\n      f = void 0 === l ? \"click\" : l,\n      v = _c.touchEvent,\n      s = void 0 === v ? \"touchend\" : v,\n      m = e(null),\n      p = e(null),\n      h = e(!1);\n  t(function () {\n    return setTimeout(function () {\n      h.current = !0;\n    }, 0), function () {\n      h.current = !1;\n    };\n  }, []);\n\n  var E = function E(n) {\n    return function (e) {\n      p.current = e.target;\n      var t = null == a ? void 0 : a.props[n];\n      t && t(e);\n    };\n  };\n\n  t(function () {\n    var n = function n(_n) {\n      h.current && (m.current && m.current.contains(_n.target) || p.current === _n.target || !document.contains(_n.target) || d(_n));\n    };\n\n    return document.addEventListener(f, n), document.addEventListener(s, n), function () {\n      document.removeEventListener(f, n), document.removeEventListener(s, n);\n    };\n  }, [f, d, s]);\n  var y = u[f],\n      g = u[s];\n  return n.Children.only(r(a, (o(i = {\n    ref: function ref(n) {\n      m.current = n;\n      var e = a.ref;\n      \"function\" == typeof e ? e(n) : e && (e.current = n);\n    }\n  }, y, E(y)), o(i, g, E(g)), i)));\n};\n\nc.displayName = \"ClickAwayListener\";\nexport default c;","map":{"version":3,"sources":["../src/index.tsx"],"names":["eventTypeMapping","click","mousedown","mouseup","touchstart","touchend","ClickAwayListener","children","onClickAway","mouseEvent","touchEvent","node","useRef","bubbledEventTarget","mountedRef","useEffect","setTimeout","current","handleBubbledEvents","type","event","target","handler","props","childRef","ref","handleEvents","contains","document","addEventListener","removeEventListener","mappedMouseEvent","mappedTouchEvent","React","Children","only","cloneElement","displayName"],"mappings":"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","sourcesContent":["import React, {\n\tuseRef,\n\tuseEffect,\n\tRefCallback,\n\tcloneElement,\n\tReactElement,\n\tHTMLAttributes,\n\tMutableRefObject,\n\tFunctionComponent\n} from 'react';\n\ntype MouseEvents = 'click' | 'mousedown' | 'mouseup';\ntype TouchEvents = 'touchstart' | 'touchend';\ntype Events = MouseEvent | TouchEvent;\ninterface Props extends HTMLAttributes<HTMLElement> {\n\tonClickAway: (event: Events) => void;\n\tmouseEvent?: MouseEvents;\n\ttouchEvent?: TouchEvents;\n\tchildren: ReactElement<any>;\n}\n\nconst eventTypeMapping = {\n\tclick: 'onClick',\n\tmousedown: 'onMouseDown',\n\tmouseup: 'onMouseUp',\n\ttouchstart: 'onTouchStart',\n\ttouchend: 'onTouchEnd'\n};\n\nconst ClickAwayListener: FunctionComponent<Props> = ({\n\tchildren,\n\tonClickAway,\n\tmouseEvent = 'click',\n\ttouchEvent = 'touchend'\n}) => {\n\tconst node = useRef<HTMLElement | null>(null);\n\tconst bubbledEventTarget = useRef<EventTarget | null>(null);\n\tconst mountedRef = useRef(false);\n\n\t/**\n\t * Prevents the bubbled event from getting triggered immediately\n\t * https://github.com/facebook/react/issues/20074\n\t */\n\tuseEffect(() => {\n\t\tsetTimeout(() => {\n\t\t\tmountedRef.current = true;\n\t\t}, 0);\n\n\t\treturn () => {\n\t\t\tmountedRef.current = false;\n\t\t};\n\t}, []);\n\n\tconst handleBubbledEvents =\n\t\t(type: string) =>\n\t\t(event: Events): void => {\n\t\t\tbubbledEventTarget.current = event.target;\n\n\t\t\tconst handler = children?.props[type];\n\n\t\t\tif (handler) {\n\t\t\t\thandler(event);\n\t\t\t}\n\t\t};\n\n\tconst handleChildRef = (childRef: HTMLElement) => {\n\t\tnode.current = childRef;\n\n\t\tlet { ref } = children as typeof children & {\n\t\t\tref: RefCallback<HTMLElement> | MutableRefObject<HTMLElement>;\n\t\t};\n\n\t\tif (typeof ref === 'function') {\n\t\t\tref(childRef);\n\t\t} else if (ref) {\n\t\t\tref.current = childRef;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst handleEvents = (event: Events): void => {\n\t\t\tif (!mountedRef.current) return;\n\n\t\t\tif (\n\t\t\t\t(node.current && node.current.contains(event.target as Node)) ||\n\t\t\t\tbubbledEventTarget.current === event.target ||\n\t\t\t\t!document.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonClickAway(event);\n\t\t};\n\n\t\tdocument.addEventListener(mouseEvent, handleEvents);\n\t\tdocument.addEventListener(touchEvent, handleEvents);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(mouseEvent, handleEvents);\n\t\t\tdocument.removeEventListener(touchEvent, handleEvents);\n\t\t};\n\t}, [mouseEvent, onClickAway, touchEvent]);\n\n\tconst mappedMouseEvent = eventTypeMapping[mouseEvent];\n\tconst mappedTouchEvent = eventTypeMapping[touchEvent];\n\n\treturn React.Children.only(\n\t\tcloneElement(children as ReactElement<any>, {\n\t\t\tref: handleChildRef,\n\t\t\t[mappedMouseEvent]: handleBubbledEvents(mappedMouseEvent),\n\t\t\t[mappedTouchEvent]: handleBubbledEvents(mappedTouchEvent)\n\t\t})\n\t);\n};\n\nClickAwayListener.displayName = 'ClickAwayListener';\n\nexport default ClickAwayListener;\n"]},"metadata":{},"sourceType":"module"}