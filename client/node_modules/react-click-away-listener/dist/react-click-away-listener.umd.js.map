{"version":3,"file":"react-click-away-listener.umd.js","sources":["../src/index.tsx"],"sourcesContent":["import React, {\n\tuseRef,\n\tuseEffect,\n\tRefCallback,\n\tcloneElement,\n\tReactElement,\n\tHTMLAttributes,\n\tMutableRefObject,\n\tFunctionComponent\n} from 'react';\n\ntype MouseEvents = 'click' | 'mousedown' | 'mouseup';\ntype TouchEvents = 'touchstart' | 'touchend';\ntype Events = MouseEvent | TouchEvent;\ninterface Props extends HTMLAttributes<HTMLElement> {\n\tonClickAway: (event: Events) => void;\n\tmouseEvent?: MouseEvents;\n\ttouchEvent?: TouchEvents;\n\tchildren: ReactElement<any>;\n}\n\nconst eventTypeMapping = {\n\tclick: 'onClick',\n\tmousedown: 'onMouseDown',\n\tmouseup: 'onMouseUp',\n\ttouchstart: 'onTouchStart',\n\ttouchend: 'onTouchEnd'\n};\n\nconst ClickAwayListener: FunctionComponent<Props> = ({\n\tchildren,\n\tonClickAway,\n\tmouseEvent = 'click',\n\ttouchEvent = 'touchend'\n}) => {\n\tconst node = useRef<HTMLElement | null>(null);\n\tconst bubbledEventTarget = useRef<EventTarget | null>(null);\n\tconst mountedRef = useRef(false);\n\n\t/**\n\t * Prevents the bubbled event from getting triggered immediately\n\t * https://github.com/facebook/react/issues/20074\n\t */\n\tuseEffect(() => {\n\t\tsetTimeout(() => {\n\t\t\tmountedRef.current = true;\n\t\t}, 0);\n\n\t\treturn () => {\n\t\t\tmountedRef.current = false;\n\t\t};\n\t}, []);\n\n\tconst handleBubbledEvents =\n\t\t(type: string) =>\n\t\t(event: Events): void => {\n\t\t\tbubbledEventTarget.current = event.target;\n\n\t\t\tconst handler = children?.props[type];\n\n\t\t\tif (handler) {\n\t\t\t\thandler(event);\n\t\t\t}\n\t\t};\n\n\tconst handleChildRef = (childRef: HTMLElement) => {\n\t\tnode.current = childRef;\n\n\t\tlet { ref } = children as typeof children & {\n\t\t\tref: RefCallback<HTMLElement> | MutableRefObject<HTMLElement>;\n\t\t};\n\n\t\tif (typeof ref === 'function') {\n\t\t\tref(childRef);\n\t\t} else if (ref) {\n\t\t\tref.current = childRef;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst handleEvents = (event: Events): void => {\n\t\t\tif (!mountedRef.current) return;\n\n\t\t\tif (\n\t\t\t\t(node.current && node.current.contains(event.target as Node)) ||\n\t\t\t\tbubbledEventTarget.current === event.target ||\n\t\t\t\t!document.contains(event.target as Node)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tonClickAway(event);\n\t\t};\n\n\t\tdocument.addEventListener(mouseEvent, handleEvents);\n\t\tdocument.addEventListener(touchEvent, handleEvents);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(mouseEvent, handleEvents);\n\t\t\tdocument.removeEventListener(touchEvent, handleEvents);\n\t\t};\n\t}, [mouseEvent, onClickAway, touchEvent]);\n\n\tconst mappedMouseEvent = eventTypeMapping[mouseEvent];\n\tconst mappedTouchEvent = eventTypeMapping[touchEvent];\n\n\treturn React.Children.only(\n\t\tcloneElement(children as ReactElement<any>, {\n\t\t\tref: handleChildRef,\n\t\t\t[mappedMouseEvent]: handleBubbledEvents(mappedMouseEvent),\n\t\t\t[mappedTouchEvent]: handleBubbledEvents(mappedTouchEvent)\n\t\t})\n\t);\n};\n\nClickAwayListener.displayName = 'ClickAwayListener';\n\nexport default ClickAwayListener;\n"],"names":["eventTypeMapping","click","mousedown","mouseup","touchstart","touchend","ClickAwayListener","children","onClickAway","mouseEvent","touchEvent","node","useRef","bubbledEventTarget","mountedRef","useEffect","setTimeout","current","handleBubbledEvents","type","event","target","handler","props","handleEvents","contains","document","addEventListener","removeEventListener","mappedMouseEvent","mappedTouchEvent","React","Children","only","cloneElement","ref","childRef","displayName"],"mappings":"0eAqBA,IAAMA,EAAmB,CACxBC,MAAO,UACPC,UAAW,cACXC,QAAS,YACTC,WAAY,eACZC,SAAU,cAGLC,EAA8C,kBACnDC,IAAAA,SACAC,IAAAA,gBACAC,WAAAA,aAAa,cACbC,WAAAA,aAAa,aAEPC,EAAOC,SAA2B,MAClCC,EAAqBD,SAA2B,MAChDE,EAAaF,UAAO,GAM1BG,aAAU,kBACTC,YAAW,WACVF,EAAWG,SAAU,IACnB,GAEI,WACNH,EAAWG,SAAU,KAEpB,QAEGC,EACL,SAACC,UACD,SAACC,GACAP,EAAmBI,QAAUG,EAAMC,WAE7BC,EAAUf,MAAAA,SAAAA,EAAUgB,MAAMJ,GAE5BG,GACHA,EAAQF,KAkBXL,aAAU,eACHS,EAAe,SAACJ,GAChBN,EAAWG,UAGdN,EAAKM,SAAWN,EAAKM,QAAQQ,SAASL,EAAMC,SAC7CR,EAAmBI,UAAYG,EAAMC,SACpCK,SAASD,SAASL,EAAMC,SAK1Bb,EAAYY,YAGbM,SAASC,iBAAiBlB,EAAYe,GACtCE,SAASC,iBAAiBjB,EAAYc,GAE/B,WACNE,SAASE,oBAAoBnB,EAAYe,GACzCE,SAASE,oBAAoBlB,EAAYc,MAExC,CAACf,EAAYD,EAAaE,QAEvBmB,EAAmB7B,EAAiBS,GACpCqB,EAAmB9B,EAAiBU,UAEnCqB,UAAMC,SAASC,KACrBC,eAAa3B,QACZ4B,IA3CqB,SAACC,GACvBzB,EAAKM,QAAUmB,MAETD,EAAQ5B,EAAR4B,IAIa,mBAARA,EACVA,EAAIC,GACMD,IACVA,EAAIlB,QAAUmB,KAkCbP,EAAmBX,EAAoBW,QACvCC,EAAmBZ,EAAoBY,iBAK3CxB,EAAkB+B,YAAc"}